\section{Эксперимент} \label{sec:experiment}

\subsection{Снятие измерений}

Запуск описанных в предыдущей секции программ осуществлялся на персональном компьютере с двухъядерным
процессором AMD E-300 под управлением операционной системы Linux с версией ядра
4.10.13. Более подробная информация о системе представлена в приложениях
\nameref{app:lscpu} и \nameref{app:uname}.

Для того, чтобы уменьшить шум, создаваемый множеством пользовательских процессов
и драйверов, которые обычно запущены на системе, измерения проводились без запуска
системы инициализации \texttt{systemd}. Для этого, при загрузке ядра, ему был
передан параметр \texttt{init=/bin/sh}, благодаря чему первым процессом, который
будет запущен ядром, будет оболочка \texttt{sh}. Из этой оболочки производился
запуск скрипта \nameref{app:collect}, вывод которого перенаправлялся в файл.

Использованная модель процессора поддерживает автоматическое изменение своей частоты
работы "на лету". Для избежания возможного влияния этой функции на точность измерений,
она была выключена вручную при помощи утилиты \texttt{cpupower},
а частота работы процессора установлена в неизменяемое значение 780 МГц.

Было снято $10^6$ измерений времени рельаной обработки запроса, которая была обозначена в
уравнении~\ref{eq:noise} как $X$, и столько же измерений времени, получаемого атакующим,
которе было обозначено в уравнении~\ref{eq:noise} как $Z$. Это было сделано при помощи
команд, представленных на листинге~\ref{src:collcalls}. При каждом измерении цикл
вызовов функции сравнения строк в программе \nameref{app:vuln} выполнял 10 итераций.

На листинге \ref{src:collcalls} представлены Shell-команды, использованные для снятия
измерений.

\begin{lstlisting}[caption=Команды снятия измерений, label=src:collcalls]
$ ./collect.pl ./vulnerable 1000000 10 5 > int-to-5-init.csv
$ ./collect.pl './timestamp ./vulnerable' 1000000 10 5 > ext-to-5-init.csv
\end{lstlisting}

В результате выполнения команд из листинга~\ref{src:collcalls} были получены два файла
\texttt{int-to-5-init.csv} и \texttt{ext-to-5-init.csv}. Каждый из которых содержит CSV-таблицу
из трёх столбцов:

\begin{description}
\item [\texttt{iterations}] -- число итераций цикла, представленного на
  листинге~\ref{src:vulnsnip}, совершённых при каждом вызове программы \nameref{app:vuln}
  (в данно случае, всегда равняется 10);
\item [\texttt{cycles}] -- измеренное время в циклах процессора;
\item [\texttt{length}] -- длина общего префикса переданной программе \nameref{app:vuln} строки и
  внутренней строки, которая хранится в самой программе.
\end{description}

\subsection{Анализ измерений}

В качестве инструмента для анализа снятых измерений было решено выбрать язык программирования
R \cite{r}, так как это очень мощный инструмент для статистического анализа и на нём реализованы
все требуемые для данной работы статистические алгоритмы.

В данной секции представлены графики функций ядерной оценки плотности
распределения (kernel density estimate) для внутренних и внешних задержек.
Они позволяют визуально оценить форму расрпеделений полученных измерений, а так же
видуально сравнить измерения между собой.

На графике \ref{fig:kde-in} представлены оценки плотности распределения
внутренней задержки сравнения строк, которые совпали на различное количество
первых символов.

\addimghere
{data/sca-playground.wiki/strcmp_Timing_Attack/attempt-2/slides/int-to-5-init-non-outliers-density.png}{}
{Ядерная оценка плотности распределения внутренней задержки}
{fig:kde-in}

Формы этих функций распределения схожи, но имеют различные
смещения по горизонтали. Эти смещения возрастают с ростом длины общего префикса
сравниваемых строк.

На графике \ref{fig:kde-out} показаны плотности распределения внешней задержки
сравнения строк, совпавших на различное число первых символов.

\addimghere
{data/sca-playground.wiki/strcmp_Timing_Attack/attempt-2/slides/ext-to-5-init-density.png}{}
{Ядерная оценка плотности распределения внешней задержки}
{fig:kde-out}

Эти распределения имеют настолько схожую форму, что визуально не различимы.
Кроме того, внешние измерения сильнее смещены вправо, чем внутренние. Это объясняется
шумом, который для внутренних измерений намного больше, чем для внешних.

Для сравнения того, насколько сильно шум, присутствующий во внешних измерениях,
повлиял на среднервадратичное отклонение задержки, были построены несмещённые
точечные оценки среднеквадратичного отклонения, которые представлены в следующих
талицах.

% Table created by stargazer v.5.2 by Marek Hlavac, Harvard University. E-mail: hlavac at fas.harvard.edu
% Date and time: Tue, May 23, 2017 - 08:11:20 AM
\begin{table}[!htbp] \centering 
\caption{Точечные оценки среднеквадратического отклонения внутренних измерений ($s_{in}$)} 
\label{pe_s_in} 
\begin{tabular}{@{\extracolsep{5pt}} ccc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
Длина & $s_{in}$ \\ 
\hline \\[-1.8ex] 
$0$ & $51.764$ \\ 
$1$ & $49.222$ \\ 
$2$ & $50.634$ \\ 
$3$ & $50.772$ \\ 
$4$ & $52.566$ \\ 
\hline \\[-1.8ex] 
\end{tabular} 
\end{table} 

Полученные значения $s_{out}$ примерно в $10^6$ раз превышают $s_{in}$. Это
свидетельствует о том, что шум, обозначенный в уравнении \ref{eq:noise} как $Y$,
имеет большое значение среднекведратичного отклоления.

% Table created by stargazer v.5.2 by Marek Hlavac, Harvard University. E-mail: hlavac at fas.harvard.edu
% Date and time: Tue, May 23, 2017 - 08:29:22 AM
\begin{table}[!htbp] \centering 
\caption{Точечные оценки среднеквадратического отклонения внешних измерений ($s_{out}$)} 
\label{pe_s_out}
\begin{tabular}{@{\extracolsep{5pt}} ccc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
Длина & $s_{out}$ \\ 
\hline \\[-1.8ex] 
$0$ & $51,045.670$ \\ 
$1$ & $51,055.780$ \\ 
$2$ & $51,097.950$ \\ 
$3$ & $51,228.100$ \\ 
$4$ & $51,135.910$ \\ 
\hline \\[-1.8ex] 
\end{tabular} 
\end{table} 

В следующих таблицах представлены доверительные интервалы для математического
ожидания внутренней внешней задержек. Уровень надёжности, выбранный для
построения доверительных интервалов, равен $\alpha = 0.99$.

% Table created by stargazer v.5.2 by Marek Hlavac, Harvard University. E-mail: hlavac at fas.harvard.edu
% Date and time: Tue, May 23, 2017 - 08:03:32 AM
\begin{table}[!htbp] \centering 
  \caption{Доверительные интервалы мат. ожидания} 
  \label{} 
\begin{tabular}{@{\extracolsep{5pt}} cccc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
 Длина & $\mu_{in} - ME_{in}$ & $\mu_{in} + ME_{in}$ \\ 
\hline \\[-1.8ex] 
 $0$ & $879.413$ & $879.867$ \\ 
 $1$ & $892.966$ & $893.398$ \\ 
 $2$ & $927.871$ & $928.315$ \\ 
 $3$ & $958.985$ & $959.430$ \\ 
 $4$ & $1,009.111$ & $1,009.571$ \\ 
\hline \\[-1.8ex] 
\end{tabular} 
\end{table} 

Символом $\mu$ обозначена точечная оценка, вокруг которой был построен
доверительный интервал, а символом $ME$ предел погрешности, задающий ширину
интревала. Он представлен слагаемым $t^{\star}(\alpha) \frac{s}{\sqrt{n}}$ в
уравнении \ref{eq:confint}.

% Table created by stargazer v.5.2 by Marek Hlavac, Harvard University. E-mail: hlavac at fas.harvard.edu
% Date and time: Tue, Jun 13, 2017 - 09:16:45 AM
\begin{table}[!htbp] \centering 
  \caption{} 
  \label{} 
\begin{tabular}{@{\extracolsep{5pt}} cccc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
Длина & $\mu_{out} - ME_{out}$ & $\mu_{out} + ME_{out}$ \\ 
\hline \\[-1.8ex] 
$0$ & $1,222,233.000$ & $1,222,339.000$ \\ 
$1$ & $1,222,233.000$ & $1,222,339.000$ \\ 
$2$ & $1,222,233.000$ & $1,222,339.000$ \\ 
$3$ & $1,222,233.000$ & $1,222,339.000$ \\ 
$4$ & $1,222,233.000$ & $1,222,339.000$ \\ 
\hline \\[-1.8ex] 
\end{tabular} 
\end{table}

Для внешних задержек предел погрешности представляет собой величину порядка 106
тактов, это намного больше, чем значения из первой таблицы, которые не превышают
одного такта.

% Table created by stargazer v.5.2 by Marek Hlavac, Harvard University. E-mail: hlavac at fas.harvard.edu
% Date and time: Tue, May 23, 2017 - 09:01:52 AM
\begin{table}[!htbp] \centering 
\caption{Параметры линейной регрессии для внутренних измерений} 
\label{} 
\begin{tabular}{@{\extracolsep{5pt}}lc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
& \multicolumn{1}{c}{\textit{Зависимая переменная:}} \\ 
\cline{2-2} 
\\[-1.8ex] & X \\ 
\hline \\[-1.8ex] 
$\beta_L$ & 32.556$^{***}$ (32.461, 32.650) \\ 
$\beta_0$ & 868.782$^{***}$ (868.551, 869.013) \\ 
\hline \\[-1.8ex] 
$SE(\beta_L)$ & 51.739 (df = 999702) \\ 
\hline 
\hline
\textit{Примечание:}  & \multicolumn{1}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\ 
\end{tabular} 
\end{table}
$SE(\beta_L)$ -- стандартная ошибка для $\beta_L$
%% http://statistica.ru/theory/osnovy-lineynoy-regressii/

% Table created by stargazer v.5.2 by Marek Hlavac, Harvard University. E-mail: hlavac at fas.harvard.edu
% Date and time: Tue, May 23, 2017 - 09:05:06 AM
\begin{table}[!htbp] \centering 
\caption{Параметры линейной регрессии для внешних измерений} 
\label{} 
\begin{tabular}{@{\extracolsep{5pt}}lc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
& \multicolumn{1}{c}{\textit{Зависимая переменная:}} \\ 
\cline{2-2} 
\\[-1.8ex] & $X$ \\ 
\hline \\[-1.8ex] 
$\beta_L$ & 78.012$^{**}$ ($-$15.081, 171.105) \\ 
$\beta_0$ & 1.2e+6$^{***}$ (1,222,255, 1,222,711) \\ 
\hline \\[-1.8ex] 
$SE(\beta_L)$ & 51,112.740 (df = 999998) \\ 
\hline 
\hline \\[-1.8ex] 
\textit{Примечание:}  & \multicolumn{1}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\ 
\end{tabular} 
\end{table} 
$SE(\beta_L)$ -- стандартная ошибка для $\beta_L$

\subsection{Результат}

Доверительный интервал для наклона в линейной модели:
\begin{equation}
\beta_L = \hat{\beta_L} \pm t^{*}_{df} \times SE(\beta_L)
\end{equation}
\begin{itemize}
\item $t^{*}_{df}$ -- критическое значение t-критерия Стьюдента, определяется
     требуемым уроврем надёжности ($\alpha = 0.99$) и числом степеней свободы $df$;
\item $\hat{\beta_L}$ -- точечная оценка наклона;
\item $SE(\beta_L)$ -- стандартная ошибка $\beta_L$.
\end{itemize}

Стандартная ошибка: \\
\begin{equation}
SE(\beta_L) = \frac{ \sigma_{res} }{ \sum^n_{i=1} (L_i - \bar{L})^2 }
\end{equation}
\begin{equation}
\sigma_{res}^2 = \frac{ \sum^n_{i=1}  (X_i - f(L_i))^2 }{ n - 2 }
\end{equation}
\begin{itemize}
\item $\sigma_{res}^2$ -- несмещённая оценка дисперсии ошибок \\
\item $f(L) = \beta_{L} \times L + \beta_0$ -- функция предсказания времени для заданной длины строки \\
\end{itemize}

Выборка из $n = 10^6$ измерений имеет $ME = t^{*}_{df} \times SE(\beta_L) = 186.186$.
Если атакующий хочет различать случай с $\beta_L = 3.2556$ от случая с $\beta_L = 0$,
ему потребуется уменьшить $ME$ до $\frac{3.2556}{2} = 1.6278$. Для этого,
значение $SE(\beta_L)$ потребуется уменьшить в $\frac{186.186}{1.6278} = 114.37$,
что, в свою очередь, потребует увеличения $n$ в $114.37^2 = 13082.53$ раз.
\\[0.5cm]
Снятие $n = 10^6$ измерений потребовало около часа времени. Умножение этого времени в $13082.53$
раз, даёт 2 года 15 дней.

\clearpage
